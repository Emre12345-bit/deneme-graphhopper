# Traffic-Aware GraphHopper Docker Management

.PHONY: help build up down logs clean restart status shell health setup test

help:
	@echo "ğŸš€ Traffic-Aware GraphHopper Docker Commands:"
	@echo ""
	@echo "ğŸ“¦ Setup & Build:"
	@echo "  setup    - First time setup (clone, build, start)"
	@echo "  build    - Build Docker image"
	@echo ""
	@echo "ğŸš€ Runtime:"
	@echo "  up       - Start services"
	@echo "  down     - Stop services"
	@echo "  restart  - Restart services"
	@echo "  status   - Show status"
	@echo ""
	@echo "ğŸ“Š Monitoring:"
	@echo "  logs     - Show logs"
	@echo "  health   - Health check"
	@echo "  test     - Test API endpoints"
	@echo ""
	@echo "ğŸ§¹ Maintenance:"
	@echo "  clean    - Clean everything (containers, images, cache)"
	@echo "  shell    - Open shell in container"

setup: ## First time setup - build and start
	@echo "ğŸš€ Setting up Traffic-Aware GraphHopper..."
	@echo "ğŸ“¦ Building Docker image (this may take 10-15 minutes)..."
	docker-compose build --no-cache
	@echo "ğŸš€ Starting GraphHopper..."
	docker-compose up -d
	@echo "âœ… Setup complete! Check logs with: make logs"
	@echo "ğŸŒ API will be available at: http://localhost:8989"
	@echo "ğŸ“Š Admin panel at: http://localhost:8990"

build:
	@echo "ğŸ“¦ Building GraphHopper Docker image..."
	docker-compose build --no-cache

up:
	@echo "ğŸš€ Starting GraphHopper..."
	docker-compose up -d
	@echo "âœ… GraphHopper started!"
	@echo "ğŸŒ API: http://localhost:8989"
	@echo "ğŸ“Š Admin: http://localhost:8990"

down:
	@echo "ğŸ›‘ Stopping GraphHopper..."
	docker-compose down

logs:
	@echo "ğŸ“‹ Showing logs..."
	docker-compose logs -f

clean:
	@echo "ğŸ§¹ Cleaning up containers and images..."
	docker-compose down -v --rmi all
	@echo "ğŸ—‘ï¸  Removing cache files..."
	rm -rf turkey-graph-cache/ || true
	@echo "âœ… Cleanup complete!"

restart:
	@echo "ğŸ”„ Restarting GraphHopper..."
	docker-compose restart

status:
	@echo "ğŸ“Š Container status:"
	docker-compose ps

shell:
	@echo "ğŸš Opening shell in container..."
	docker-compose exec graphhopper-app /bin/bash

health:
	@echo "ğŸ¥ Health check..."
	curl -f http://localhost:8989/health || echo "âŒ Health check failed"

test: ## Test API endpoints
	@echo "ğŸ§ª Testing API endpoints..."
	@echo "Testing basic route..."
	curl -s "http://localhost:8989/route?point=37.989355,32.523069&point=37.860192,32.547872&profile=car&locale=tr&points_encoded=false" | jq '.paths[0].distance' 2>/dev/null || echo "âŒ API not ready yet"
	@echo "Testing EDS avoidance..."
	curl -s "http://localhost:8989/route?point=37.989355,32.523069&point=37.860192,32.547872&profile=car&avoid_eds_roads=true&locale=tr&points_encoded=false" | jq '.paths[0].distance' 2>/dev/null || echo "âŒ EDS avoidance not working" 